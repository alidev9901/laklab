const navToggle = document.getElementById('nav-toggle');
const headerNav = document.getElementById('header-navigation');
const anchors = document.querySelectorAll('.nav__list a[href^="#"]');

/* =============================== Events =============================== */

navToggle.addEventListener('click', function() {
  this.classList.toggle('header__nav-toggle--active');
  headerNav.classList.toggle('header__navigation--active');
  document.body.classList.toggle('overflow-hidden');
});

if( anchors ) {
  anchors.forEach(function(link) {
    link.addEventListener('click', function() {
      navToggle.click();
    });
  });
}

document.addEventListener('click', function(e) {

  

  if( document.querySelector('.select--active') && !document.querySelector('.select--active').contains(e.target) ) {

    document.querySelector('.select--active').classList.remove('select--active')

  }

});



/* =============================== Sliders =============================== */

const introSlider = new Swiper('.intro__slider', {
  slidesPerView: 1,
  grabCursor: true,
  spaceBetween: 0,
  navigation: {
    nextEl: '.intro__nav-button--next',
    prevEl: '.intro__nav-button--prev',
  },
})

const gallerySlider = new Swiper('.gallery__slider', {
  slidesPerView: 'auto',
  grabCursor: true,
  watchSlidesVisibility: true,
  freeMode: true,
  breakpoints: {
    0: {
      spaceBetween: 5
    },
    992: {
      spaceBetween: 10
    }
  }
})

/* =============================== Functions =============================== */

dropdown();

function dropdown() {

  const dropdowns = document.querySelectorAll('.dropdown');
  
  dropdowns.forEach((dropdown) => {

    // Dropdown button
    const button = dropdown.querySelector('button');
    button.addEventListener('click', function() {

      const elements = Array.from(this.closest('.dropdown-container').querySelectorAll('.dropdown--active'));
      const otherElements = elements.filter((el) => el !== this.closest('.dropdown'));

      if( otherElements.length > 0 ) {
        otherElements[0].classList.remove('dropdown--active')
        otherElements[0].querySelector('.dropdown__content').slideToggle()
      }

      this.closest('.dropdown').classList.toggle('dropdown--active');
      this.closest('.dropdown').querySelector('.dropdown__content').slideToggle()

      
    });

  });

}

select();

function select() {
  const select = document.querySelectorAll('.select');

  if( select ) {
    select.forEach(function(item) {
      
      const current = item.querySelector('.select__current');
      current.addEventListener('click', function() {

        const curr = this.closest('.select');
        curr.classList.toggle('select--active');

      });

      const listItems = item.querySelectorAll('.select__list-item');

      if( listItems ) {

        listItems.forEach(function(listItem) {

          listItem.addEventListener('click', function() {

            if( this.classList.contains('current') ) return;

            this.closest('.select__list').querySelector('li.current').classList.remove('current');
            this.classList.add('current');
            this.closest('.select').querySelector('.select__current span').textContent = this.textContent;

            const contentId = this.dataset.id;

            document.querySelector('.price__item.current').classList.remove('current');
            document.getElementById(contentId).classList.add('current');

            this.closest('.select').classList.remove('select--active');


          });

        });

      }


    });
  }

}

// Slide Toggle Vanilla JS
HTMLElement.prototype.slideToggle = function(duration, callback) {
  if (this.clientHeight === 0) {
    _s(this, duration, callback, true);
  } else {
    _s(this, duration, callback);
  }
};

function _s(el, duration, callback, isDown) {
  
  if (typeof duration === 'undefined') duration = 400;
  if (typeof isDown === 'undefined') isDown = false;

  el.style.overflow = "hidden";
  if (isDown) el.style.display = "grid";

  var elStyles        = window.getComputedStyle(el);

  var elHeight        = parseFloat(elStyles.getPropertyValue('height'));
  var elPaddingTop    = parseFloat(elStyles.getPropertyValue('padding-top'));
  var elPaddingBottom = parseFloat(elStyles.getPropertyValue('padding-bottom'));
  var elMarginTop     = parseFloat(elStyles.getPropertyValue('margin-top'));
  var elMarginBottom  = parseFloat(elStyles.getPropertyValue('margin-bottom'));

  var stepHeight        = elHeight        / duration;
  var stepPaddingTop    = elPaddingTop    / duration;
  var stepPaddingBottom = elPaddingBottom / duration;
  var stepMarginTop     = elMarginTop     / duration;
  var stepMarginBottom  = elMarginBottom  / duration;

  var start;

  function step(timestamp) {

    if (start === undefined) start = timestamp;

    var elapsed = timestamp - start;

    if (isDown) {
      el.style.height        = (stepHeight        * elapsed) + "px";
      el.style.paddingTop    = (stepPaddingTop    * elapsed) + "px";
      el.style.paddingBottom = (stepPaddingBottom * elapsed) + "px";
      el.style.marginTop     = (stepMarginTop     * elapsed) + "px";
      el.style.marginBottom  = (stepMarginBottom  * elapsed) + "px";
    } else {
      el.style.height        = elHeight        - (stepHeight        * elapsed) + "px";
      el.style.paddingTop    = elPaddingTop    - (stepPaddingTop    * elapsed) + "px";
      el.style.paddingBottom = elPaddingBottom - (stepPaddingBottom * elapsed) + "px";
      el.style.marginTop     = elMarginTop     - (stepMarginTop     * elapsed) + "px";
      el.style.marginBottom  = elMarginBottom  - (stepMarginBottom  * elapsed) + "px";
    }

    if (elapsed >= duration) {
      el.style.height        = "";
      el.style.paddingTop    = "";
      el.style.paddingBottom = "";
      el.style.marginTop     = "";
      el.style.marginBottom  = "";
      el.style.overflow      = "";
      if (!isDown) el.style.display = "none";
      if (typeof callback === 'function') callback();
    } else {
      window.requestAnimationFrame(step);
    }
  }

  window.requestAnimationFrame(step);
}